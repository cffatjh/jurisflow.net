@model List<JurisFlowASP.Models.AuditLog>
@{
    ViewData["Title"] = "Denetim Günlükleri";
}

<div class="row">
    <!-- Sidebar -->
    <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    <a href="@Url.Action("Index", "Settings")" class="list-group-item list-group-item-action">
                        <i class="bi bi-person me-2"></i> Profil
                    </a>
                    <a href="@Url.Action("ChangePassword", "Settings")" class="list-group-item list-group-item-action">
                        <i class="bi bi-key me-2"></i> Şifre Değiştir
                    </a>
                    <a href="@Url.Action("Notifications", "Settings")" class="list-group-item list-group-item-action">
                        <i class="bi bi-bell me-2"></i> Bildirimler
                    </a>
                    <hr class="my-0">
                    <a href="@Url.Action("Users", "Settings")" class="list-group-item list-group-item-action">
                        <i class="bi bi-people me-2"></i> Kullanıcılar
                    </a>
                    <a href="@Url.Action("AuditLogs", "Settings")" class="list-group-item list-group-item-action active">
                        <i class="bi bi-journal-text me-2"></i> Denetim Günlükleri
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Denetim Günlükleri</h5>
            </div>
            <div class="card-body">
                <!-- Filters -->
                <form method="get" class="row g-3 mb-4">
                    <div class="col-md-4">
                        <select name="action" class="form-select">
                            <option value="">Tüm İşlemler</option>
                            <option value="CREATE" selected="@(ViewBag.CurrentAction == "CREATE")">Oluşturma</option>
                            <option value="UPDATE" selected="@(ViewBag.CurrentAction == "UPDATE")">Güncelleme</option>
                            <option value="DELETE" selected="@(ViewBag.CurrentAction == "DELETE")">Silme</option>
                            <option value="LOGIN" selected="@(ViewBag.CurrentAction == "LOGIN")">Giriş</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select name="entityType" class="form-select">
                            <option value="">Tüm Varlıklar</option>
                            <option value="User" selected="@(ViewBag.CurrentEntityType == "User")">Kullanıcı</option>
                            <option value="Client" selected="@(ViewBag.CurrentEntityType == "Client")">Müvekkil</option>
                            <option value="Matter" selected="@(ViewBag.CurrentEntityType == "Matter")">Dava</option>
                            <option value="Task" selected="@(ViewBag.CurrentEntityType == "Task")">Görev</option>
                            <option value="Invoice" selected="@(ViewBag.CurrentEntityType == "Invoice")">Fatura</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-funnel me-1"></i> Filtrele
                        </button>
                        <a href="@Url.Action("AuditLogs")" class="btn btn-outline-secondary">Temizle</a>
                    </div>
                </form>

                <!-- Logs Table -->
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead class="table-light">
                            <tr>
                                <th>Tarih</th>
                                <th>Kullanıcı</th>
                                <th>İşlem</th>
                                <th>Varlık</th>
                                <th>Detay</th>
                                <th>IP</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var log in Model)
                            {
                                var actionClass = log.Action switch
                                {
                                    "CREATE" => "text-success",
                                    "UPDATE" => "text-warning",
                                    "DELETE" => "text-danger",
                                    _ => "text-primary"
                                };
                                
                                <tr>
                                    <td class="text-nowrap">
                                        <small>@log.CreatedAt.ToString("dd/MM/yyyy HH:mm:ss")</small>
                                    </td>
                                    <td>
                                        <small>@(log.UserEmail ?? log.ClientEmail ?? "-")</small>
                                    </td>
                                    <td>
                                        <span class="@actionClass fw-semibold">@log.Action</span>
                                    </td>
                                    <td>@log.EntityType</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(log.Details))
                                        {
                                            <small class="text-muted">@log.Details</small>
                                        }
                                        else if (!string.IsNullOrEmpty(log.EntityId))
                                        {
                                            <small class="text-muted">ID: @log.EntityId.Substring(0, Math.Min(8, log.EntityId.Length))...</small>
                                        }
                                    </td>
                                    <td><small class="text-muted">@log.IpAddress</small></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                @if (ViewBag.TotalPages > 1)
                {
                    <nav>
                        <ul class="pagination justify-content-center mb-0">
                            @for (int i = 1; i <= ViewBag.TotalPages; i++)
                            {
                                <li class="page-item @(ViewBag.Page == i ? "active" : "")">
                                    <a class="page-link" href="?page=@i&action=@ViewBag.CurrentAction&entityType=@ViewBag.CurrentEntityType">@i</a>
                                </li>
                            }
                        </ul>
                    </nav>
                }
            </div>
        </div>
    </div>
</div>
